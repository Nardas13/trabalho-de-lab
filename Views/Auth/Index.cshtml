@{
    ViewData["Title"] = "Login / Criar Conta";
    Layout = "_Layout";
    ViewBag.AuthPage = true;
}

@if (TempData["AuthError"] is string err)
{
    <div class="inline-msg inline-error">@err</div>
}
@if (TempData["AuthSuccess"] is string ok)
{
    <div class="inline-msg inline-success">@ok</div>
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css?v=@DateTime.Now.Ticks" />
}

<div class="auth-page">
    <div class="auth-wrapper fade-up">

        <!-- LOGIN -->
        <div id="login-box" class="auth-card @(TempData["AuthErrorSource"]?.ToString() == "register" ? "" : "active")">
            <h1 class="auth-title">Iniciar Sessão</h1>

            <form method="post" action="/Auth/Login">
                <input type="email" name="Email" placeholder="Email" required />
                <div class="pwd-wrapper">
                    <input type="password" id="login-password" name="Password" placeholder="Password" required />
                    <img src="@Url.Content("~/imgs/eye-off.jpg")" class="eye-icon" onclick="togglePwd('login-password', this)" />
                </div>

                <a class="forgot" href="/Auth/ForgotPassword">Esqueceste-te da palavra-passe?</a>

                <button type="submit" class="auth-btn">Iniciar Sessão</button>
            </form>

            <div class="auth-divider"><span>ou</span></div>

            <button type="button" class="social-btn google-btn">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google">
                Continuar com Google
            </button>

            <p class="auth-switch">
                Não tens conta?
                <a href="#" onclick="showRegister()">Criar Conta</a>
            </p>
        </div>

        <!-- REGISTO -->
        <div id="register-box" class="auth-card @(TempData["AuthErrorSource"]?.ToString() == "register" ? "active" : "")">
            <p class="step-indicator">Passo 1 de 2</p>
            <h1 class="auth-title">Criar Conta</h1>

            <form method="post" action="/Auth/Register" class="form-grid">

                <input type="text" name="Nome" placeholder="Nome completo" required value="@(TempData["Nome"] ?? "")" />
                <input type="email" name="Email" placeholder="Email" required value="@(TempData["Email"] ?? "")" />
                <input type="text" name="Username" placeholder="Username" required value="@(TempData["Username"] ?? "")" />
                <input type="text" name="Contacto" placeholder="Contacto" required value="@(TempData["Contacto"] ?? "")" />

                <div class="pwd-wrapper">
                    <input type="password" id="reg-password" name="Password" placeholder="Password" required />
                    <img src="@Url.Content("~/imgs/eye-off.jpg")" class="eye-icon" onclick="togglePwd('reg-password', this)" />
                </div>

                <div class="pwd-wrapper">
                    <input type="password" id="reg-confirm" name="ConfirmPassword" placeholder="Confirmar Pass" required />
                    <img src="@Url.Content("~/imgs/eye-off.jpg")" class="eye-icon" onclick="togglePwd('reg-confirm', this)" />
                </div>

                <input type="text" name="Morada" placeholder="Morada" required
                       class="full-row"
                       value="@(TempData["Morada"] ?? "")" />

                <p class="legal-text full-row">
                    Ao criares conta, concordas com os
                    <a href="/Termos#termos">Termos & Políticas</a>
                    e com a nossa
                    <a href="/Termos#privacidade">Política de Privacidade</a>.
                </p>

                <div class="full-row">
                    <button type="submit" class="auth-btn">Criar Conta</button>
                </div>

            </form>

            <p class="auth-switch">
                Já tens conta? <a href="#" onclick="showLogin()">Fazer Login</a>
            </p>
        </div>

    </div>
</div>

<script>
    function showRegister() {
        document.getElementById("login-box").classList.remove("active");
        document.getElementById("register-box").classList.add("active");
    }

    function showLogin() {
        document.getElementById("register-box").classList.remove("active");
        document.getElementById("login-box").classList.add("active");
    }

    // FINAL, 100% FUNCIONAL
    function togglePwd(id, icon) {
        const input = document.getElementById(id);

        if (input.type === "password") {
            input.type = "text";
            icon.src = "@Url.Content("~/imgs/eye.jpg")";     
        } else {
            input.type = "password";
            icon.src = "@Url.Content("~/imgs/eye-off.jpg")"; 
        }
    }
</script>

<script>
    setTimeout(() => {
        document.querySelectorAll('.inline-msg').forEach(m => {
            m.style.opacity = "0";
            m.style.transition = "0.4s";
        });
    }, 2800);
</script>

@if (TempData["AuthErrorSource"]?.ToString() == "register"
    && TempData["AuthError"]?.ToString() == "As passwords não coincidem.")
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("reg-password").classList.add("input-error");
            document.getElementById("reg-confirm").classList.add("input-error");
        });
    </script>
}
