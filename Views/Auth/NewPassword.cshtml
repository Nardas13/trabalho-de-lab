@{
    ViewData["Title"] = "Nova Password";
    Layout = "_Layout";
    ViewBag.AuthPage = true;
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css?v=@DateTime.Now.Ticks" />

    <style>
        .auth-page {
            min-height: calc(100vh - 140px) !important;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }
        body {
            background: var(--bg-gradient-vertical) !important;
        }
    </style>
}

@if (TempData["AuthError"] is string err)
{
    <div class="inline-msg inline-error">@err</div>
}

<div class="auth-page">
    <div class="auth-wrapper fade-up">
        <div class="auth-card active">

            <p class="step-indicator">Passo 3 de 3</p>
            <h1 class="auth-title">Criar nova password</h1>

            <form method="post" action="/Auth/NewPassword">

                <input type="hidden" name="Email" value="@ViewBag.Email" />

                <!-- Nova password -->
                <div class="pwd-wrapper">
                    <input type="password" id="new-pass" name="Password"
                           placeholder="Nova password"
                           required oninput="validatePasswords()" />

                    <img src="@Url.Content("~/imgs/eye-off.jpg")"
                         class="eye-icon"
                         onclick="togglePwd('new-pass', this)" />
                </div>

                <!-- Confirmar -->
                <div class="pwd-wrapper">
                    <input type="password" id="confirm-pass" name="ConfirmPassword"
                           placeholder="Confirmar password"
                           required oninput="validatePasswords()" />

                    <img src="@Url.Content("~/imgs/eye-off.jpg")"
                         class="eye-icon"
                         onclick="togglePwd('confirm-pass', this)" />
                </div>

                <button type="submit" id="submitBtn" class="auth-btn disabled" disabled>
                    Atualizar Password
                </button>

            </form>

        </div>
    </div>
</div>

<script>

    function togglePwd(id, icon) {
        const input = document.getElementById(id);
        const show = "@Url.Content("~/imgs/eye.jpg")";
        const hide = "@Url.Content("~/imgs/eye-off.jpg")";

        const isHidden = input.type === "password";
        input.type = isHidden ? "text" : "password";
        icon.src = isHidden ? show : hide;
    }

    function validatePasswords() {
        const p1 = document.getElementById("new-pass");
        const p2 = document.getElementById("confirm-pass");
        const btn = document.getElementById("submitBtn");

        if (p1.value.length < 3 || p1.value !== p2.value) {
            p2.classList.add("input-error");
            btn.disabled = true;
            btn.classList.add("disabled");
        } else {
            p2.classList.remove("input-error");
            btn.disabled = false;
            btn.classList.remove("disabled");
        }
    }

</script>
