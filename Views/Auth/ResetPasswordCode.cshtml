@{
    ViewData["Title"] = "Confirmar Código";
    Layout = "_Layout";
    ViewBag.AuthPage = true;
}

@if (TempData["AuthError"] is string err)
{
    <div class="inline-msg inline-error">@err</div>
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css?v=@DateTime.Now.Ticks" />
}

<div class="auth-page">
    <div class="auth-wrapper fade-up">
        <div class="auth-card active verify-card">

            <p class="verify-step">Passo 2 de 3</p>

            <h1 class="verify-title">Verifique o seu e-mail</h1>

            <p class="verify-sub">
                Introduz o código enviado para <br>
                <strong>@ViewBag.Email</strong>
            </p>

            <form method="post" action="/Auth/ResetPasswordCode" class="verify-form">
                <input type="hidden" name="Email" value="@ViewBag.Email" />

                <!-- CAIXAS DO CÓDIGO -->
                <div class="code-boxes">
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,0)" />
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,1)" />
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,2)" />
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,3)" />
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,4)" />
                    <input maxlength="1" class="code-digit" oninput="moveNext(this,5)" />
                </div>

                <input type="hidden" id="Codigo" name="Codigo" />

                <button type="submit" class="auth-btn verify-btn">Confirmar Código</button>
            </form>

            <p class="verify-resend">
                Não recebeste o código?
                <a href="/Auth/ResendResetCode?email=@ViewBag.Email">Reenviar</a>
            </p>

        </div>
    </div>
</div>

<script>
    const digits = document.querySelectorAll(".code-digit");
    const hidden = document.getElementById("Codigo");

    digits.forEach((d, index) => {
        d.addEventListener("input", e => {
            // Permitir só dígitos
            e.target.value = e.target.value.replace(/\D/g, "");

            // Avança automaticamente
            if (e.target.value && index < digits.length - 1) {
                digits[index + 1].focus();
            }

            // Atualiza valor combinado
            hidden.value = [...digits].map(x => x.value).join('');
        });

        d.addEventListener("keydown", e => {
            // Backspace volta para trás se estiver vazio
            if (e.key === "Backspace" && d.value === "" && index > 0) {
                digits[index - 1].focus();
            }
        });
    });
</script>

